<div class="student-list-page">
  <div class="page-header">
    <div>
      <h1 class="page-title">Students</h1>
      <p class="page-subtitle">Manage student profiles and enrollments</p>
    </div>
    <button class="btn btn-primary" (click)="navigateToCreate()">
      <span class="btn-icon">+</span> Add Student
    </button>
  </div>

  <!-- Toolbar -->
  <div class="toolbar">
    <div class="search-box">
      <span class="search-icon">ğŸ”</span>
      <input
        type="text"
        class="search-input"
        placeholder="Search students..."
        [formControl]="searchControl">
    </div>



    <div class="view-toggle">
      <button
        class="view-btn"
        [class.active]="viewMode() === 'grid'"
        (click)="viewMode.set('grid')"
        title="Grid view">âŠ</button>
      <button
        class="view-btn"
        [class.active]="viewMode() === 'table'"
        (click)="viewMode.set('table')"
        title="Table view">â˜°</button>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading()" class="loading-wrapper">
    <app-spinner [size]="40" message="Loading students..."></app-spinner>
  </div>

  <!-- Grid View -->
  <ng-container *ngIf="!loading() && viewMode() === 'grid'">
    <div *ngIf="students().length > 0; else emptyRef" class="student-grid">
      <div
        *ngFor="let student of students()"
        class="student-card"
        (click)="navigateToDetail(student.id)">
        <div class="card-top-actions" (click)="$event.stopPropagation()">
          <button class="icon-btn" title="Edit" (click)="navigateToEdit(student.id)">âœ</button>
          <button class="icon-btn icon-btn--danger" title="Delete" (click)="confirmDelete(student)">ğŸ—‘</button>
        </div>
        <div
          class="student-avatar"
          [appAvatar]="getFullName(student)"
          [avatarColor]="'#6366f1'"
          [avatarSize]="64">
        </div>
        <div class="student-name">{{ getFullName(student) }}</div>
        <div class="student-email">{{ student.email }}</div>
        <div class="student-meta">
          <span class="course-pill">{{ getCourseCount(student) }} courses</span>
        </div>
      </div>
    </div>
  </ng-container>

  <!-- Table View -->
  <ng-container *ngIf="!loading() && viewMode() === 'table'">
    <div *ngIf="students().length > 0; else emptyRef" class="table-wrapper">
      <table class="data-table">
        <thead>
          <tr>
            <th>Student</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Courses</th>
            <th>Enrolled</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let student of students()" class="table-row" (click)="navigateToDetail(student.id)">
            <td>
              <div class="table-student">
                <div
                  class="avatar"
                  [appAvatar]="getFullName(student)"
                  [avatarColor]="'#6366f1'"
                  [avatarSize]="34">
                </div>
                <span class="table-student-name">{{ getFullName(student) }}</span>
              </div>
            </td>
            <td class="text-secondary">{{ student.email }}</td>
            <td class="text-secondary">{{ student.phoneNumber }}</td>
            <td>
              <span class="course-pill">{{ getCourseCount(student) }}</span>
            </td>
            <td (click)="$event.stopPropagation()">
              <div class="table-actions">
                <button class="icon-btn" (click)="navigateToEdit(student.id)">âœ</button>
                <button class="icon-btn icon-btn--danger" (click)="confirmDelete(student)">ğŸ—‘</button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </ng-container>

  <!-- Empty State -->
  <ng-template #emptyRef>
    <app-empty-state
      *ngIf="!loading()"
      icon="ğŸ“"
      title="No students found"
      message="No students match your current filters.">
      <button class="btn btn-primary" (click)="navigateToCreate()">+ Add Student</button>
    </app-empty-state>
  </ng-template>

  <!-- Count Footer -->
  <div *ngIf="!loading() && students().length > 0" class="results-footer">
    Showing {{ students().length }} student{{ students().length !== 1 ? 's' : '' }}
  </div>
</div>

<app-confirm-dialog
  [visible]="showDeleteDialog()"
  [title]="'Delete Student'"
  [message]="'Are you sure you want to delete ' + (deleteTarget()?.firstName || '') + ' ' + (deleteTarget()?.lastName || '') + '? This action cannot be undone.'"
  confirmLabel="Delete"
  [danger]="true"
  (confirmed)="onDeleteConfirmed()"
  (cancelled)="onDeleteCancelled()">
</app-confirm-dialog>
